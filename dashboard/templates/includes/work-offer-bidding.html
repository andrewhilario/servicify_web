{% load static %}
{% block css_files %}
<link rel="stylesheet" href="{% static 'css/includes/work-offer-bidding.css' %}">
{% endblock %}
{% load humanize %}
{% block content %}
{% include 'navbar.html' %}


<div class="wo-bidding">
    <a href="/">
        <i class="fa-solid fa-caret-left"></i>
        <span>Return to Homepage</span>
    </a>
    <h2>Work Offer Biddings</h2>
    <div class="wo-contents">
        <div class="wo-image-view">
            {% for img in work_offer.workofferimage_set.all|slice:":1" %}
            <div class="wo-main-img">

                <img src="{{ img.image.url }}" alt="" id="img-preview">

            </div>
            {% endfor %}
            <div class="wo-img-thumbs">
                {% for img in work_offer.workofferimage_set.all %}
                <div class="wo-sub-img">
                    <img src="{{ img.image.url }}" alt="" id="img-thumbnails" onclick="myFunction(this);">
                </div>
                {% endfor %}
            </div>

        </div>
        <div class="wo-details-and-bid">
            <div class="wo-sub-contents">
                <div class="wo-details">
                    <h3>{{ work_offer.work_name }}</h3>
                    <div class="wo-sub-details">
                        <div class="wo-img-sub-details">
                            <div class="wo-img-container">
                                <img src="{{ work_offer.created_by.avatar.url }}" alt="">
                            </div>
                            <span>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                        </div>
                        <div class="wo-content-sub-details">
                            <ul>
                                <li>
                                    <p>Posted By:</p>
                                    <span>{{ work_offer.created_by.full_name }}</span>
                                </li>
                                <li>
                                    <p>Location:</p>
                                    <span>Muntinlupa City</span>
                                </li>
                                <li>
                                    <p>Work Posted: </p>
                                    <span>{{ client_work_posted }}</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <p class="wo-description">
                        <span><strong>Description: </strong></span> <br>
                        {{ work_offer.description }}
                    </p>
                </div>
                <div class="wo-time-limit">
                    {% if winning_bid %}
                    <span>Closed</span>
                    {% endif %}
                    <div class="wo-timer">
                        <i class="fa-solid fa-clock"></i>
                        <span>Created {{ work_offer.created_at|naturaltime }}</span>
                    </div>
                </div>
            </div>
            <div class="wo-pricing">
                {% if winning_bid %}
                <div class="wo-winning-bid">
                    <div class="wo-winning-bid-details">
                        <p>Winning Bid:</p>
                        <span>‚Ç±{% filter intcomma %}{{ winning_bid.bid_amount|floatformat }}{% endfilter %}</span>
                    </div>
                    <div>
                        Placed by: <img class="mini-avatar" src="{{ winning_bid.bidder_id.avatar.url }}" alt="">
                        {{ winning_bid.bidder_id.full_name }}</div>
                </div>
                {% endif %}
                <div class="wo-current-price">
                    <div class="wo-highest-bid">
                        <p>Highest Bid:</p>
                        <span>‚Ç±{% filter intcomma %}{{ highest_bid.bid_amount|floatformat }}{% endfilter %}</span>
                    </div>
                    <div>
                        Placed by: <img class="mini-avatar" src="{{ highest_bid.bidder_id.avatar.url }}" alt="">
                        {{ highest_bid.bidder_id.full_name }}
                    </div>
                </div>
                <div class="wo-bid-incre">
                    <p>Starting Bid:</p>
                    <span>‚Ç±{% filter intcomma %}{{ work_offer.min_pay|floatformat }}{% endfilter %}</span>
                </div>
            </div>
            <div class="wo-bidding-input">
                {% if request.user.is_authenticated %}
                {% if winning_bid %}
                    <em>Bidding is already closed.</em>
                {% else %}
                <form method="post">
                    {% csrf_token %}
                    {% if form_errors %}
                    <div class="wo-bid-error">
                        <p>Unable to create bid:</p>
                        {% for error in form_errors %}
                        <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    <div class="wo-bid-input">
                        <p>‚Ç±</p>
                        {{ bid_form.bid_amount }}
                        <button type="submit">Bid Now</button>
                    </div>

                    <div class="wo-bid-message">
                        {{ bid_form.bidder_msg }}
                    </div>
                </form>
                {% endif %}
                {% else %}
                <p>Login to place bid</p>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="wo-bidders">
        <div class="wo-active-and-total-bids">
            {% if winning_bid %}
            <div class="wo-winning-bid">
                <i class="fa-solid fa-award"></i>
                <div class="wo-sub-content">
                    <p>Winning Bid:</p>
                    {{ winning_bid.created_at }}
                    <img class="mini-avatar" src="{{ winning_bid.bidder_id.avatar.url }}" alt=""> 
                    {{ winning_bid.bidder_id.full_name }}
                    Description
                    {{ winning_bid.bidder_msg }}
                    ‚Ç±{{ winning_bid.bid_amount }}
                </div>
            </div>
            {% else %}
            <div class="wo-active-bids">
                <i class="fa-solid fa-hand"></i>
                <div class="wo-sub-content">
                    <span>{{ active_bids }}</span>
                    <p>Active Bids:</p>
                </div>
            </div>
            {% endif %}
            <div class="wo-total-bids">
                <i class="fa-solid fa-gavel"></i>
                <div class="wo-sub-content">
                    <span>{{ total_bids }}</span>
                    <p>Total Bids</p>
                </div>
            </div>
        </div>
        <div class="wo-latest-bidder">
            <div class="wo-latest-bid">
                {% if latest_bid %}
                <div class="wo-latest-bid-content">
                    <p>Latest Bidder: </p>
                    <span>
                        <img class="mini-avatar" src="{{ latest_bid.bidder_id.avatar.url }}" alt=""> 
                        {{ latest_bid.bidder_id.full_name }}
                    </span>
                </div>
                <div class="wo-latest-bid-content">
                    <p>Latest Bid: </p>
                    <span>‚Ç±{{ latest_bid.bid_amount }}</span>
                </div>
                {% else %}
                <div class="wo-latest-bid-content">
                    No recent bids ü§∑‚Äç‚ôÇÔ∏è
                </div>
                {% endif %}
            </div>
            <div class="wo-other-bid">
                <p>Other Bids:</p>
                <div class="wo-other-bid-tbl">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Details</th>
                                <th>Bid</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for bid in bids %}
                            <tr>
                                <td>{{ bid.created_at }}</td>
                                <td>
                                    <img class="mini-avatar" src="{{ bid.bidder_id.avatar.url }}" alt=""> 
                                    {{ bid.bidder_id.full_name }}
                                    Description
                                    {{ bid.bidder_msg }}
                                </td>
                                <td>‚Ç±{{ bid.bid_amount }}</td>
                                <td>{{ bid.status }}</td>
                                <td><a href="{% url 'view_bidding_details' work_offer.id bid.id %}">View</a></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<button id="scroll-top" class="scroll-top"><i class="fa-solid fa-arrow-up"></i></button>
{% include 'footer.html' %}
{% endblock %}